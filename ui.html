ui
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kettei | The Decision Mirror</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@200;300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-paper: #f8f7f2;
            --ink-sumi: #4a4a4a;
            --gold-kintsugi: #d4af37;
            --accent-ajisai: #8c92ac;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-paper);
            color: var(--ink-sumi);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.05);
        }

        .fade-in { animation: fadeIn 1s cubic-bezier(0.22, 1, 0.36, 1) forwards; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .breath-ring {
            width: 200px;
            height: 200px;
            border: 1px solid var(--accent-ajisai);
            border-radius: 50%;
            animation: breathe 8s infinite ease-in-out;
            opacity: 0.5;
        }
        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.3; border-width: 1px; }
            50% { transform: scale(1.4); opacity: 0.1; border-width: 2px; }
        }

        .coin-container {
            perspective: 1000px;
            width: 160px;
            height: 160px;
        }
        .coin {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            border-radius: 50%;
            background: linear-gradient(135deg, #e6c86e 0%, #d4af37 50%, #b8860b 100%);
            box-shadow: 0 15px 35px rgba(212, 175, 55, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            font-weight: 200;
            border: 4px solid rgba(255,255,255,0.3);
        }
        .coin.flip {
            animation: flipCoin 1.8s cubic-bezier(0.5, 0.1, 0.3, 1) forwards;
        }
        @keyframes flipCoin {
            0% { transform: rotateY(0deg) translateY(0) scale(1); }
            40% { transform: rotateY(720deg) translateY(-250px) scale(1.1); }
            100% { transform: rotateY(2160deg) translateY(0) scale(1); }
        }

        .privacy-blur {
            filter: blur(5px);
            transition: filter 0.4s ease;
            cursor: pointer;
        }
        .privacy-blur:hover {
            filter: blur(0);
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 300px;
            max-height: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .input-underline {
            background: transparent;
            border-bottom: 1px solid #e5e5e5;
            transition: border-color 0.3s ease;
        }
        .input-underline:focus {
            outline: none;
            border-color: var(--accent-ajisai);
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 md:p-8">

    <!-- Chosen Palette: Wabi-sabi (Rice Paper #f8f7f2, Sumi Ink #4a4a4a, Kintsugi Gold #d4af37) -->
    
    <!-- Application Structure Plan:
         1. The Flow: Phase-based ritual. 
         2. Toss vs Result separation: Phase IV is strictly the act of tossing. Phase V is the revelation.
         3. Navigation: After coin animation completes, the app automatically transitions to the Result phase.
    -->

    <div id="app" class="w-full max-w-3xl relative">
        <nav class="absolute top-0 w-full flex justify-between items-center p-8 z-20 pointer-events-none">
            <div class="text-xs uppercase tracking-[0.3em] font-medium text-gray-400">Kettei <span class="text-xs opacity-50">/ æ±ºå®š</span></div>
            <button onclick="toggleBacklog()" class="pointer-events-auto text-[10px] tracking-[0.2em] uppercase hover:text-[#d4af37] transition-colors flex items-center gap-2">
                <span>The Vault</span>
                <span class="text-lg">ðŸ“œ</span>
            </button>
        </nav>

        <main class="glass-panel rounded-[2rem] md:rounded-[3rem] min-h-[700px] flex flex-col relative overflow-hidden transition-all duration-500">
            
            <!-- PHASE 1: INTENTION -->
            <section id="phase-intention" class="absolute inset-0 p-8 md:p-16 flex flex-col justify-center fade-in">
                <div class="intro-block mb-12">
                    <p class="text-xs text-[#8c92ac] uppercase tracking-widest mb-4">Phase I: The Crossroad</p>
                    <h1 class="text-3xl md:text-4xl font-light leading-tight">What decision weighs on your mind today?</h1>
                </div>

                <div class="relative w-full mb-12">
                    <textarea id="decision-input" placeholder="Speak your truth or write it here..." 
                        class="input-underline w-full py-4 text-xl md:text-2xl font-light resize-none h-32 bg-transparent placeholder-gray-300"></textarea>
                    
                    <button id="mic-btn" onclick="toggleSpeech()" class="mt-4 flex items-center gap-2 text-xs text-gray-400 hover:text-gray-600 transition-colors uppercase tracking-widest group">
                        <span class="text-lg group-hover:text-[#d4af37] transition-colors">ðŸŽ¤</span>
                        <span id="mic-status">Tap to Speak</span>
                    </button>
                </div>

                <div class="mt-auto flex justify-end">
                    <button onclick="navigate('phase-reflection')" class="group flex items-center gap-4 px-8 py-3 rounded-full border border-gray-200 hover:border-[#d4af37] transition-all">
                        <span class="text-xs uppercase tracking-widest text-gray-500 group-hover:text-black">Begin Ritual</span>
                        <span class="text-lg">â†’</span>
                    </button>
                </div>
            </section>

            <!-- PHASE 2: REFLECTION -->
            <section id="phase-reflection" class="absolute inset-0 p-8 md:p-16 flex flex-col hidden overflow-y-auto no-scrollbar">
                <div class="mb-10">
                    <p class="text-xs text-[#8c92ac] uppercase tracking-widest mb-4">Phase II: Reflection</p>
                    <h2 class="text-2xl font-light">Examine the shadows of this choice.</h2>
                </div>

                <div class="space-y-12 mb-16">
                    <div class="group">
                        <label class="block text-sm font-medium mb-3">Would you regret <span class="italic">not</span> taking this path?</label>
                        <input type="text" id="q-regret" class="input-underline w-full py-2 bg-transparent" placeholder="Why or why not?">
                    </div>
                    <div class="group">
                        <label class="block text-sm font-medium mb-3">What is the heaviest fear holding you back?</label>
                        <input type="text" id="q-fear" class="input-underline w-full py-2 bg-transparent" placeholder="Name the fear...">
                    </div>
                    <div class="group">
                        <label class="block text-sm font-medium mb-3">Where is the 'You' of one year from now?</label>
                        <input type="text" id="q-future" class="input-underline w-full py-2 bg-transparent" placeholder="Visualize the outcome...">
                    </div>
                </div>

                <div class="mt-auto flex justify-between items-center pb-8">
                    <button onclick="navigate('phase-intention')" class="text-xs uppercase tracking-widest text-gray-400 hover:text-black">Back</button>
                    <button id="btn-to-ritual" onclick="navigate('phase-ritual')" class="group flex items-center gap-4 px-8 py-3 rounded-full bg-[#4a4a4a] text-white hover:bg-black transition-all">
                        <span class="text-xs uppercase tracking-widest">Enter Silence</span>
                    </button>
                </div>
            </section>

            <!-- PHASE 3: RITUAL (Silence) -->
            <section id="phase-ritual" class="absolute inset-0 flex flex-col items-center justify-center hidden">
                <div class="breath-ring absolute"></div>
                <div class="text-center z-10 space-y-8">
                    <p id="breath-guide" class="text-xs uppercase tracking-[0.5em] text-[#8c92ac] transition-opacity duration-1000">Breathe In</p>
                    <p class="text-2xl font-light max-w-md leading-relaxed text-gray-600">Clear the mind.<br>The answer is already within you.</p>
                </div>
                <button id="btn-ready-toss" onclick="navigate('phase-toss')" class="absolute bottom-16 opacity-0 transition-opacity duration-1000 text-xs uppercase tracking-widest border-b border-transparent hover:border-[#d4af37] pb-1">
                    I am ready to receive
                </button>
            </section>

            <!-- PHASE 4: TOSS (Action Only) -->
            <section id="phase-toss" class="absolute inset-0 flex flex-col items-center justify-center hidden">
                <div class="coin-container cursor-pointer mb-12" onclick="performToss()">
                    <div id="coin" class="coin"><span id="coin-content" class="text-4xl">?</span></div>
                </div>

                <div id="toss-instructions" class="text-center">
                    <p class="text-xs uppercase tracking-[0.3em] text-gray-400 mb-2">Phase IV: The Catalyst</p>
                    <p class="text-lg font-light animate-pulse">Tap the coin to release control.</p>
                </div>
            </section>

            <!-- PHASE 5: RESULT (Revelation & Reaction) -->
            <section id="phase-result" class="absolute inset-0 flex flex-col items-center justify-center hidden p-8">
                <div class="text-center mb-12 fade-in">
                    <p class="text-xs text-gray-400 uppercase tracking-widest mb-4">Phase V: The Outcome</p>
                    <h2 id="toss-result-text" class="text-6xl font-light text-[#d4af37]">YES</h2>
                </div>

                <div id="reaction-panel" class="w-full max-w-md px-4 fade-in">
                    <p class="text-center text-sm mb-10 text-gray-500 italic">How does this revelation make you <span class="italic">actually</span> feel?</p>
                    <div class="space-y-4">
                        <button onclick="selectReaction('Relieved')" class="w-full p-5 bg-white/50 hover:bg-white border border-transparent hover:border-[#d4af37] rounded-2xl text-left text-sm transition-all flex justify-between items-center group">
                            <span>I feel relieved.</span>
                            <span class="opacity-0 group-hover:opacity-100">âœ“</span>
                        </button>
                        <button onclick="selectReaction('Anxious')" class="w-full p-5 bg-white/50 hover:bg-white border border-transparent hover:border-[#d4af37] rounded-2xl text-left text-sm transition-all flex justify-between items-center group">
                            <span>I feel anxious / disappointed.</span>
                            <span class="opacity-0 group-hover:opacity-100">âœ“</span>
                        </button>
                        <button onclick="selectReaction('Nothing')" class="w-full p-5 bg-white/50 hover:bg-white border border-transparent hover:border-[#d4af37] rounded-2xl text-left text-sm transition-all flex justify-between items-center group">
                            <span>I feel nothing / numb.</span>
                            <span class="opacity-0 group-hover:opacity-100">âœ“</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- PHASE 6: ANALYSIS -->
            <section id="phase-analysis" class="absolute inset-0 p-8 md:p-16 flex flex-col hidden overflow-y-auto no-scrollbar">
                <div class="text-center mb-10">
                    <div class="inline-block px-3 py-1 border border-[#d4af37] rounded-full text-[10px] uppercase tracking-widest text-[#d4af37] mb-4">Phase VI: The Mirror Review</div>
                    <h2 class="text-3xl font-light">The mirror reveals your truth.</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white/60 p-6 rounded-2xl border border-white flex flex-col justify-center">
                        <span class="text-[10px] uppercase tracking-widest text-gray-400 mb-2">Your Gut Feeling</span>
                        <span id="display-reaction" class="text-xl font-medium">--</span>
                    </div>
                    <div class="bg-[#4a4a4a] text-white p-6 rounded-2xl flex flex-col justify-center items-center text-center">
                        <span class="text-[10px] uppercase tracking-widest opacity-60 mb-2">The Coin Said</span>
                        <span id="display-toss-final" class="text-3xl font-light text-[#d4af37]">--</span>
                    </div>
                </div>

                <div class="bg-[#f8f7f2] p-8 rounded-2xl border border-gray-200 mb-8 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-[#d4af37]"></div>
                    <h3 class="text-xs uppercase tracking-widest text-[#8c92ac] mb-4">Insight</h3>
                    <p id="analysis-text" class="text-lg leading-relaxed font-light italic text-gray-700"></p>
                </div>

                <div class="mt-auto text-center">
                    <button onclick="resetApp()" class="text-xs uppercase tracking-widest border-b border-gray-300 hover:border-black pb-1 transition-all">Archive & Start New Ritual</button>
                </div>
            </section>
        </main>
    </div>

    <!-- THE VAULT -->
    <div id="backlog-modal" class="fixed inset-0 bg-[#f8f7f2]/95 backdrop-blur-xl z-50 hidden transition-opacity duration-300 opacity-0 flex items-center justify-center p-4">
        <div class="w-full max-w-4xl h-[90vh] bg-white rounded-[2rem] shadow-2xl p-8 md:p-12 overflow-y-auto relative flex flex-col md:flex-row gap-8">
            <button onclick="toggleBacklog()" class="absolute top-8 right-8 text-2xl hover:rotate-90 transition-transform">Ã—</button>
            <div class="w-full md:w-1/3 flex flex-col gap-8">
                <div>
                    <h2 class="text-2xl font-light mb-2">The Vault</h2>
                    <p class="text-xs text-gray-400 uppercase tracking-widest">History of Intuition</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-2xl">
                    <h3 class="text-[10px] uppercase tracking-widest text-gray-500 mb-4">Clarity Trends</h3>
                    <div class="chart-container" style="height: 200px;"><canvas id="clarityChart"></canvas></div>
                </div>
            </div>
            <div class="w-full md:w-2/3">
                <h3 class="text-xs uppercase tracking-widest text-gray-500 mb-6 sticky top-0 bg-white py-2">Archives (Hover to Reveal)</h3>
                <div id="backlog-list" class="space-y-6"></div>
            </div>
        </div>
    </div>

    <!-- CONFIRMATION: NO SVG used. NO Mermaid JS used. -->

    <script>
        const state = {
            decision: '',
            tossResult: null,
            reaction: null,
            date: null
        };

        const backlogKey = 'kettei_vault_v2';
        let clarityChart = null;

        function navigate(phaseId) {
            document.querySelectorAll('main > section').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('fade-in');
            });
            const target = document.getElementById(phaseId);
            target.classList.remove('hidden');
            target.classList.add('fade-in');
            if(phaseId === 'phase-ritual') startBreathingExercise();
        }

        function toggleSpeech() {
            const btn = document.getElementById('mic-status');
            const input = document.getElementById('decision-input');
            if (!('webkitSpeechRecognition' in window)) {
                btn.textContent = "Not Supported";
                return;
            }
            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'en-US';
            recognition.onstart = () => { btn.textContent = "Listening..."; btn.parentElement.classList.add('text-[#d4af37]'); };
            recognition.onend = () => { btn.textContent = "Tap to Speak"; btn.parentElement.classList.remove('text-[#d4af37]'); };
            recognition.onresult = (e) => {
                const transcript = e.results[0][0].transcript;
                input.value = transcript;
                state.decision = transcript;
            };
            recognition.start();
        }

        function startBreathingExercise() {
            const guide = document.getElementById('breath-guide');
            const btn = document.getElementById('btn-ready-toss');
            let breatheIn = true;
            btn.style.opacity = '0';
            btn.classList.add('pointer-events-none');
            const interval = setInterval(() => {
                breatheIn = !breatheIn;
                guide.textContent = breatheIn ? "Breathe In" : "Breathe Out";
            }, 4000);
            setTimeout(() => {
                btn.style.opacity = '1';
                btn.classList.remove('pointer-events-none');
            }, 8000);
        }

        function performToss() {
            const coin = document.getElementById('coin');
            const instructions = document.getElementById('toss-instructions');
            if(coin.classList.contains('flip')) return;
            
            // 1. Start Animation
            coin.classList.add('flip');
            instructions.style.opacity = '0';
            
            // 2. Logic
            const isHeads = Math.random() > 0.5;
            state.tossResult = isHeads ? 'YES' : 'NO';
            
            // 3. Navigate to Result Phase after animation ends
            setTimeout(() => {
                document.getElementById('coin-content').textContent = state.tossResult;
                document.getElementById('toss-result-text').textContent = state.tossResult;
                navigate('phase-result');
            }, 1800);
        }

        function selectReaction(type) {
            state.reaction = type;
            generateAnalysis();
            navigate('phase-analysis');
        }

        function generateAnalysis() {
            const { reaction, tossResult } = state;
            const displayR = document.getElementById('display-reaction');
            const displayT = document.getElementById('display-toss-final');
            const insightText = document.getElementById('analysis-text');

            displayR.textContent = reaction === 'Nothing' ? 'Numbness' : reaction;
            displayT.textContent = tossResult;

            let insight = "";
            let clarityScore = 0;

            if (reaction === 'Nothing') {
                insight = "You feel no spark of reaction to this result. This numbness suggests the question you asked is not the real question at hand. The choice you are trying to make is likely a distraction from a deeper path you haven't faced yet.";
                clarityScore = 15;
            } else if (reaction === 'Relieved') {
                insight = `The coin said ${tossResult}, and your soul exhaled. This relief is the clearest signal available to a human being. It indicates that your subconscious was already leaning toward this outcome, and the coin simply gave you permission to acknowledge it.`;
                clarityScore = 95;
            } else if (reaction === 'Anxious') {
                insight = `The coin landed on ${tossResult}, and your immediate reaction was one of dread or anxiety. Do not ignore this. The coin has done its job by showing you what you *don't* want. If a "Yes" makes you anxious, your answer is "No".`;
                clarityScore = 80;
            }

            saveToBacklog(insight, clarityScore);
        }

        function saveToBacklog(insight, score) {
            const entry = {
                ...state,
                insight,
                score,
                date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                timestamp: Date.now()
            };
            const history = JSON.parse(localStorage.getItem(backlogKey) || '[]');
            history.unshift(entry);
            localStorage.setItem(backlogKey, JSON.stringify(history));
        }

        function toggleBacklog() {
            const modal = document.getElementById('backlog-modal');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.remove('opacity-0'), 10);
                renderBacklogItems();
                renderChart();
            } else {
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function renderBacklogItems() {
            const history = JSON.parse(localStorage.getItem(backlogKey) || '[]');
            const list = document.getElementById('backlog-list');
            if(history.length === 0) {
                list.innerHTML = `<div class="text-center text-gray-300 py-10 italic">Empty.</div>`;
                return;
            }
            list.innerHTML = history.map(item => `
                <div class="privacy-blur group bg-gray-50 p-6 rounded-2xl border border-gray-100 transition-all hover:bg-white hover:shadow-lg">
                    <div class="flex justify-between items-baseline mb-2">
                        <span class="text-[10px] uppercase tracking-widest text-gray-400">${item.date}</span>
                        <span class="text-[10px] uppercase tracking-widest ${item.score > 60 ? 'text-[#d4af37]' : 'text-gray-400'}">Depth: ${item.score}%</span>
                    </div>
                    <h4 class="text-lg font-medium mb-2">${item.decision || "Unnamed Crossroad"}</h4>
                    <p class="text-xs text-gray-500 mb-3 uppercase tracking-widest">Toss: ${item.tossResult} / Reaction: ${item.reaction}</p>
                    <p class="text-sm font-light italic text-gray-600">"${item.insight}"</p>
                </div>
            `).join('');
        }

        function renderChart() {
            const history = JSON.parse(localStorage.getItem(backlogKey) || '[]');
            const chronHistory = [...history].reverse();
            const ctx = document.getElementById('clarityChart').getContext('2d');
            if (clarityChart) clarityChart.destroy();
            clarityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chronHistory.map(h => h.date),
                    datasets: [{
                        data: chronHistory.map(h => h.score),
                        borderColor: '#d4af37',
                        backgroundColor: 'rgba(212, 175, 55, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 100, ticks: { display: false }, grid: { display: false } },
                        x: { grid: { display: false }, ticks: { display: false } }
                    }
                }
            });
        }

        function resetApp() {
            state.decision = ''; state.tossResult = null; state.reaction = null;
            document.getElementById('decision-input').value = '';
            document.querySelectorAll('input').forEach(i => i.value = '');
            document.getElementById('coin').classList.remove('flip');
            document.getElementById('coin-content').textContent = '?';
            navigate('phase-intention');
        }
    </script>
</body>
</html>